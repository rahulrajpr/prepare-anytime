# PySpark Interview Preparation Guide

## 3.8 Array Functions

### 3.8.1 How do you access array elements using getItem() or bracket notation?

**Methods:**

- **Bracket notation**: `col("array_col")[0]`
- **getItem()**: `col("array_col").getItem(0)`

**Example:**

```python
df.select(col("tags")[0].alias("first_tag"))
df.select(col("tags").getItem(0).alias("first_tag"))
```

### 3.8.2 What does array() function do to create arrays from columns?

**Purpose:** Creates an array from multiple columns or literals.

**Example:**

**python**

```
from pyspark.sql.functions import array

df.select(array("col1", "col2", "col3").alias("combined_array"))
```

### 3.8.3 How do you use array_contains() to check for element existence?

**Usage:**`array_contains(array_column, value)` returns boolean.

**Example:**

**python**

```
df.filter(array_contains("tags", "spark"))
```

### 3.8.4 What does array_distinct() do?

**Purpose:** Removes duplicate elements from array.

**Example:**`[1, 2, 2, 3]` → `[1, 2, 3]`

### 3.8.5 How do you use array_intersect(), array_union(), array_except()?

**Set Operations:**

* **array_intersect()** : Common elements in both arrays
* **array_union()** : All unique elements from both arrays
* **array_except()** : Elements in first array but not in second

### 3.8.6 What does array_join() do?

**Purpose:** Concatenates array elements into string with separator.

**Example:**`array_join(["a", "b", "c"], "-")` → `"a-b-c"`

### 3.8.7 How do you sort array elements using array_sort()?

**Usage:**`array_sort(array_column)` sorts elements in ascending order.

### 3.8.8 What is array_max(), array_min(), size() used for?

**Functions:**

* **array_max()** : Maximum element in array
* **array_min()** : Minimum element in array
* **size()** : Number of elements in array

### 3.8.9 How do you use flatten() for nested arrays?

**Purpose:** Flattens nested arrays into single-level array.

**Example:**`[[1, 2], [3, 4]]` → `[1, 2, 3, 4]`

### 3.8.10 What does array_repeat() function do?

**Purpose:** Creates array by repeating element specified number of times.

**Example:**`array_repeat("x", 3)` → `["x", "x", "x"]`

### 3.8.11 How do you use slice() to extract a portion of an array?

**Usage:**`slice(array_column, start, length)`

**Example:**`slice([1, 2, 3, 4, 5], 2, 3)` → `[2, 3, 4]`

### 3.8.12 What is array_position() used for?

**Purpose:** Returns position (1-based) of first occurrence of element.

**Example:**`array_position([1, 2, 3, 2], 2)` → `2`

### 3.8.13 How do you remove elements from an array using array_remove()?

**Usage:**`array_remove(array_column, value)`

**Example:**`array_remove([1, 2, 3, 2], 2)` → `[1, 3]`

### 3.8.14 What does shuffle() do to array elements?

**Purpose:** Randomly shuffles elements in array.

### 3.8.15 How do you use zip_with() for element-wise array operations?

**Usage:** Applies function to corresponding elements of two arrays.

**Example:**`zip_with([1, 2, 3], [4, 5, 6], (x, y) => x + y)` → `[5, 7, 9]`

## 3.8.1 Advanced Array Functions & Comparisons

### 3.8.1.1 What is the difference between size() and cardinality() functions?

**Answer:** They are functionally identical - both return the number of elements in an array.

### 3.8.1.2 Are size() and cardinality() functionally identical?

**Yes:** Both return the same result for arrays.

### 3.8.1.3 When would you use size() vs cardinality() (personal preference)?

**Guidelines:**

* **size()** : More commonly used, SQL-standard name
* **cardinality()** : PostgreSQL background, same functionality

### 3.8.1.4 What is the difference between reverse(), sort_array(), and array_sort()?

**Comparison:**

* **reverse()** : Reverses element order
* **sort_array()** : Sorts with specified order (asc/desc)
* **array_sort()** : Sorts in ascending order, handles nulls

### 3.8.1.5 What parameters does reverse() accept? What does it do?

**Parameters:**`reverse(array_column)` - reverses array element order.

### 3.8.1.6 What parameters does sort_array() accept? How do you control sort order?

**Parameters:**`sort_array(array_column, asc=True)` - second parameter controls order.

### 3.8.1.7 What parameters does array_sort() accept? What makes it unique?

**Parameters:**`array_sort(array_column)` - always ascending, places nulls at end.

### 3.8.1.8 Can you use custom sorting logic with sort_array()? What about array_sort()?

**Limitation:** Neither supports custom comparators - both use natural ordering.

### 3.8.1.9 When would you use sort_array() vs array_sort()?

**Guidelines:**

* **sort_array()** : When you need descending order
* **array_sort()** : When you want consistent null handling

### 3.8.1.10 What does aggregate() function do on arrays?

**Purpose:** Applies aggregation logic to array elements (similar to fold/reduce).

### 3.8.1.11 What parameters does aggregate() accept (start, merge, finish)?

**Parameters:**`aggregate(array, initial_value, merge_function, finish_function)`

### 3.8.1.12 What is the difference between aggregate() and reduce() on arrays?

**Answer:** They are functionally identical aliases.

### 3.8.1.13 Are aggregate() and reduce() functionally identical?

**Yes:** Same implementation, different names.

### 3.8.1.14 Which name is SQL standard: aggregate() or reduce()?

**SQL Standard:**`aggregate()` is the SQL-standard name.

### 3.8.1.15 What does concat() do for arrays? Can it handle multiple arrays?

**Purpose:** Concatenates multiple arrays into single array.

**Example:**`concat([1, 2], [3, 4], [5, 6])` → `[1, 2, 3, 4, 5, 6]`

### 3.8.1.16 What is the difference between element_at() and try_element_at()?

**Error Handling:**

* **element_at()** : Throws error for invalid indices
* **try_element_at()** : Returns null for invalid indices

### 3.8.1.17 What happens when element_at() tries to access a non-existent index?

**Behavior:** Throws ArrayIndexOutOfBoundsException.

### 3.8.1.18 What does try_element_at() return for non-existent indices?

**Returns:** null for out-of-bounds indices.

### 3.8.1.19 When should you use try_element_at() instead of element_at()?

**Use Case:** When array indices might be invalid and you want to avoid errors.

### 3.8.1.20 What does exists() function do on arrays?

**Purpose:** Returns true if any element satisfies the predicate.

### 3.8.1.21 What does forall() function do on arrays?

**Purpose:** Returns true if all elements satisfy the predicate.

### 3.8.1.22 What is the difference between exists() and forall()?

**Logic:**

* **exists()** : ANY element satisfies condition
* **forall()** : ALL elements satisfy condition

### 3.8.1.23 Do exists() and forall() short-circuit? What does this mean?

**Yes:** They stop evaluation as soon as result is determined (performance optimization).

### 3.8.1.24 What does filter() function do on arrays?

**Purpose:** Returns new array containing only elements that satisfy predicate.

### 3.8.1.25 What is the difference between filter() and exists()?

**Output:**

* **filter()** : Returns filtered array
* **exists()** : Returns boolean

### 3.8.1.26 How is filtering arrays different from filtering DataFrames?

**Scope:**

* Array filtering: Within a single column/row
* DataFrame filtering: Across entire rows

### 3.8.1.27 What does transform() function do on arrays?

**Purpose:** Applies function to each element, returns new array.

### 3.8.1.28 What parameters does transform() lambda accept (element, index)?

**Lambda:** Can accept `(element)` or `(element, index)`.

### 3.8.1.29 What does arrays_zip() function do?

**Purpose:** Merges multiple arrays into single array of structs.

### 3.8.1.30 What does zip_with() function do?

**Purpose:** Element-wise operation on two arrays with custom function.

### 3.8.1.31 What is the difference between arrays_zip() and zip_with()?

**Comparison:**

* **arrays_zip()** : Structural merge into array of structs
* **zip_with()** : Functional transformation with custom logic

### 3.8.1.32 How many arrays can arrays_zip() handle?

**Multiple:** Can handle any number of input arrays.

### 3.8.1.33 How many arrays can zip_with() handle?

**Exactly two:** Only works with two input arrays.

### 3.8.1.34 What output structure does arrays_zip() create?

**Output:** Array of structs where each struct contains corresponding elements.

### 3.8.1.35 Can you customize the output with arrays_zip()?

**No:** Output structure is fixed.

### 3.8.1.36 Does zip_with() require a lambda function?

**Yes:** Requires function to combine elements.

### 3.8.1.37 How do arrays_zip() and zip_with() handle arrays of different lengths?

**Behavior:** Result length = shortest input array, extra elements ignored.

## 3.9 Map Functions

### 3.9.1 How do you create a map using map() function or map_from_arrays()?

**Methods:**

* **map()** : `map(key1, value1, key2, value2, ...)`
* **map_from_arrays()** : `map_from_arrays(keys_array, values_array)`

### 3.9.2 How do you access map values using getItem() or bracket notation?

**Access:**

* **Bracket** : `col("map_col")["key"]`
* **getItem()** : `col("map_col").getItem("key")`

### 3.9.3 What does map_keys() and map_values() return?

**Functions:**

* **map_keys()** : Array of all keys
* **map_values()** : Array of all values

### 3.9.4 How do you use map_concat() to merge maps?

**Usage:**`map_concat(map1, map2, ...)` - later keys override earlier ones.

### 3.9.5 What does map_from_entries() do?

**Purpose:** Creates map from array of structs with key/value fields.

### 3.9.6 How do you explode maps using explode() - what columns does it create?

**Output:** Creates two columns: `key` and `value`.

### 3.9.7 What is map_filter() used for?

**Purpose:** Returns new map with entries that satisfy predicate.

### 3.9.8 How do you get the size of a map using size()?

**Usage:**`size(map_column)` returns number of key-value pairs.

## 3.9.1 Map Functions Deep Dive & Comparisons

### 3.9.1.1 What is the difference between filter() and map_filter()?

**Input Types:**

* **filter()** : Works on arrays
* **map_filter()** : Works on maps

### 3.9.1.2 What input types do filter() vs map_filter() accept?

**Accept:**

* **filter()** : Arrays
* **map_filter()** : Maps

### 3.9.1.3 How many lambda parameters does map_filter() accept?

**Parameters:** Lambda accepts `(key, value)`.

### 3.9.1.4 What does map_filter() return?

**Returns:** Filtered map with entries satisfying condition.

### 3.9.1.5 What does transform() do for arrays?

**Purpose:** Transforms each array element.

### 3.9.1.6 What does transform_keys() do for maps?

**Purpose:** Transforms map keys using function.

### 3.9.1.7 What does transform_values() do for maps?

**Purpose:** Transforms map values using function.

### 3.9.1.8 Compare transform() vs transform_keys() vs transform_values() - when to use each?

**Usage:**

* **transform()** : Array element transformation
* **transform_keys()** : Map key transformation
* **transform_values()** : Map value transformation

### 3.9.1.9 What lambda parameters does transform() accept?

**Parameters:**`(element)` or `(element, index)`.

### 3.9.1.10 What lambda parameters do transform_keys() and transform_values() accept?

**Parameters:** Both accept `(key, value)`.

### 3.9.1.11 Does transform() change the size of an array?

**No:** Output array has same size as input.

### 3.9.1.12 Does transform_keys() or transform_values() change the size of a map?

**No:** Both preserve map size.

### 3.9.1.13 What changes when you use transform_keys() - keys or values?

**Changes:** Only keys are transformed, values remain same.

### 3.9.1.14 What changes when you use transform_values() - keys or values?

**Changes:** Only values are transformed, keys remain same.

### 3.9.1.15 Can you use size() and cardinality() on maps?

**Yes:** Both work on maps and return number of entries.

### 3.9.1.16 Does element_at() work on maps? How?

**Yes:**`element_at(map, key)` returns value for given key.

### 3.9.1.17 Does try_element_at() work on maps?

**Yes:** Returns null for non-existent keys instead of error.

## 3.10 Struct Functions

### 3.10.1 How do you access struct fields using dot notation or getField()?

**Methods:**

* **Dot notation** : `col("struct_col.field_name")`
* **getField()** : `col("struct_col").getField("field_name")`

### 3.10.2 What does struct() function do to create structs from columns?

**Purpose:** Creates struct from multiple columns.

**Example:**`struct("name", "age", "city")` creates struct with these fields.

### 3.10.3 How do you flatten struct columns?

**Method:** Use `select("struct_col.*")` or explicitly select fields.

### 3.10.4 Can you use withColumn() to modify a field within a struct?

**Yes:** But you need to reconstruct the entire struct.

### 3.10.5 How do you select specific fields from a nested struct?

**Access:** Use dot notation: `col("parent_struct.child_struct.grandchild_field")`

## 3.10.1 Struct Deep Dive & Comparisons

### 3.10.1.1 What is a Struct in Apache Spark?

**Definition:** Complex type that represents nested/structured data with named fields.

### 3.10.1.2 What is the purpose of using StructType in DataFrames?

**Purpose:** Defines schema for structured data, enabling nested data representation.

### 3.10.1.3 How do structs enable representation of nested or hierarchical data?

**Capability:** Allow nesting of multiple fields within single column, supporting JSON-like structures.

### 3.10.1.4 What is the difference between struct() and named_struct()?

**Field Naming:**

* **struct()** : Uses column names or generated names
* **named_struct()** : Explicit field naming

### 3.10.1.5 How do you define field names in named_struct()?

**Syntax:**`named_struct("field1", value1, "field2", value2, ...)`

### 3.10.1.6 What field names does struct() generate by default?

**Default:** Uses column names if columns, otherwise generates names like `col1`, `col2`.

### 3.10.1.7 How do you access fields in a struct created with named_struct()?

**Access:** Same as regular structs: `col("struct_col.field1")`

### 3.10.1.8 What happens to field names when using struct() with column names vs literals?

**Behavior:**

* Columns: Use column names as field names
* Literals: Generate generic names (`col1`, `col2`)

### 3.10.1.9 When should you use named_struct() over struct()?

**Use Case:** When you need explicit control over field names, especially with literals.

### 3.10.1.10 When should you use struct() over named_struct()?

**Use Case:** When using column references and default names are acceptable.

### 3.10.1.11 What does the schema look like for named_struct('city','value','state','value')?

**Schema:**`struct<city:string, state:string>`

### 3.10.1.12 What does the schema look like for struct('value1', 'value2')?

**Schema:**`struct<col1:string, col2:string>` (generated names)

### 3.10.1.13 Can you nest structs within structs?

**Yes:** Structs can contain other structs, enabling deep nesting.

### 3.10.1.14 How do you access deeply nested struct fields?

**Access:** Chain dot notation: `col("level1.level2.level3.field")`
